# Selbal: selection of balances {#selbal}

selbal [@rivera2018balances] relies on the concept of compositional balances, which is the balance between the abundances of two groups of microbial species that is more associated with the response variable. We also generated a wrapper function called *selbal_wrapper()*. It is based on *selbal()*, but provides additional outputs. All these functions are uploaded via **functions.R**.

## CD data

```{r}
class(CD.y)
```

*selbal()* requires **Y** to be factor, as it will run logistic regression with a binary outcomes. If **Y** is numeric, *selbal()* implements linear regression.

Besides input **Y** and **X**, we also need to decide how many variables to select (**maxV**). The default performance measure (**logit.acc**) to compute the correlation between **Y** and balances is **AUC**, other opitions can be **"Dev"**, **"Rsq"** or **"Tjur"**.

```{r}
# optimization criteria Deviance
CD.results_selbal <- selbal_wrapper(Y = CD.y, X = CD.x, maxV = 12, logit.acc = 'Dev') 
CD.results_selbal$numVarSelect
CD.results_selbal$varSelect
```

The method selects 12 genera as we required.

## HFHS-Day1 data

The analysis on HFHS-Day1 data is as similar as CD data.

First, we need to check if **Y** is a factor.

```{r}
class(HFHS.y)
```
```{r}
# optimization criteria Deviance
HFHS.results_selbal <- selbal_wrapper(Y = HFHS.y, X = HFHS.x, maxV = 2, logit.acc = 'Dev') 
HFHS.results_selbal$numVarSelect
HFHS.results_selbal$varSelect
```

The method selects 2 OTUs as required.

We also extract the taxonomic information of these selected OTUs.

```{r}
HFHS.tax_selbal <- HFHS.taxonomy[which(rownames(HFHS.taxonomy) %in% 
                                         HFHS.results_selbal$varSelect), ]
kable(HFHS.tax_selbal[ ,2:6], booktabs = T)
```
